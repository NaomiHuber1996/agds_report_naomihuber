---
title: "agds_report_8"
author: "Naomi Huber"
date: "2023-06-12"
output: html_document
---

Einlesen der Daten:
```{r}
library(utils)
library(tidyverse)

website <- "https://raw.githubusercontent.com/geco-bern/agds/main/data/df_for_stepwise_regression.csv"
daten <- read.table(website, header = TRUE, sep = ",")
#remove NA values
daten <- daten |>
  tidyr::drop_na()
```

For the following stepwise forward regression performed, these predictors may suit best: - CO2_F_MDS because the more CO2 is available in the ais, the more CO2 can be taken up by photosynthesis. - TA because the ideal temperature for plants destinctions their prodcutivity and the amount of CO2 taken up by photosynthesis. - P because the more it rains, the more plants grow and the more CO2 can be taken up by photosynthesis. - PPFD_IN because the amount of the photons destinct the process of photosynthesis. - SW_IN because it is needed for the process of photosynthesis. - LW_IN because it influences the process of photosynthesis but not as much as SW_IN does.

Setting the number of predictors considered to p=1 and computing of their coefficient of determination:
```{r}
#Predictor 1 (CO2_F_MDS)
model1 <- lm(GPP_NT_VUT_REF ~ CO2_F_MDS, data = daten)
summary(model1)$r.squared

plot(GPP_NT_VUT_REF ~ CO2_F_MDS, data = daten)
abline(model1, col = "red4")

#Predictor 2 (TA_F_MDS)
model2 <- lm(GPP_NT_VUT_REF ~ TA_F_MDS, data = daten)
summary(model2)$r.squared

plot(GPP_NT_VUT_REF ~ TA_F_MDS, data = daten)
abline(model2, col = "red4")

#Predictor 3 (P_F)
model3 <- lm(GPP_NT_VUT_REF ~ P_F, data = daten)
summary(model3)$r.squared

plot(GPP_NT_VUT_REF ~ P_F, data = daten)
abline(model3, col = "red4")

#Predictor 4 (PPFD_IN)
model4 <- lm(GPP_NT_VUT_REF ~ PPFD_IN, data = daten)
summary(model4)$r.squared

plot(GPP_NT_VUT_REF ~ PPFD_IN, data = daten)
abline(model4, col = "red4")

#Predictor 5 (SW_IN_F_MDS)
model5 <- lm(GPP_NT_VUT_REF ~ SW_IN_F_MDS, data = daten)
summary(model5)$r.squared

plot(GPP_NT_VUT_REF ~ SW_IN_F_MDS, data = daten)
abline(model5, col = "red4")

#Predictor 6 (LW_IN_F_MDS)
model6 <- lm(GPP_NT_VUT_REF ~ LW_IN_F_MDS, data = daten)
summary(model6)$r.squared

plot(GPP_NT_VUT_REF ~ LW_IN_F_MDS, data = daten)
abline(model6, col = "red4")
```

Regarding all of the calculated coefficient of determination of the different predictor models, the model 4 shows an coefficient of about 0.3627837. Thus, the computation of the AIC is done with model 4.

```{r}
aic_model4 <- AIC(model4)
aic_model4
```

The AIC of the predictor 4 is 45682.99 which relates to a poor adjustment to the data. The predicted values will probably not be accurate. As this result is not appropriate enough, the AIC for the other predictors is calculated and provides the following results:
```{r}
aic_model1 <- AIC(model1)
cat("AIC of model 1: ",aic_model1, "\n")

aic_model2 <- AIC(model2)
cat("AIC of model 2: ", aic_model2, "\n")

aic_model3 <- AIC(model3)
cat("AIC of model 3: ", aic_model3, "\n")

cat("AIC of model 4: ", aic_model4, "\n")

aic_model5 <- AIC(model5)
cat("AIC of model 5: ", aic_model5, "\n")

aic_model6 <- AIC(model6)
cat("AIC of model 6: ", aic_model6)
```

Considering the values of the calculated AIC’s, the model 4 provides the most suitable value of about 45682.99 becauses it is the lowest one. According to this result, further steps will be done for the predictor 4. Further, we plot a Q-Q-Plot:
```{r}
plot(model6, 2)
```

To identify the best predictor in the model, it is better to use the stepwise forward regression. In the present case this is done as follows:
```{r}
#modify the data by 
modified_data <- subset(daten, select = -c(siteid, TIMESTAMP, TA_F, SW_IN_F, LW_IN_F, VPD_F, PA_F, P_F, WS_F))
modified_data
```

```{r}
abhängige_variable <- which(names(modified_data) == "GPP_NT_VUT_REF")

predictors <- setdiff(1:ncol(modified_data), abhängige_variable)
best_predictor <- "PPFD_IN"

results <- list()

#Modell mit dem besten Prädiktor
formel <- as.formula(paste("GPP_NT_VUT_REF ~", best_predictor))
model <- lm(formel, data = modified_data)
best_aic <- AIC(model)
results[[best_predictor]] <- best_aic

#Schleife über die Prädiktoren
for (i in setdiff(predictors, best_predictor)) {
  predictor <- paste0("predictor", i)
  formel <- as.formula(paste("GPP_NT_VUT_REF ~", paste0(best_predictor, "+", names(modified_data)[i]), collapse = ""))
  model <- lm(formel, data = modified_data)
  aic <- AIC(model)
  results[[predictor]] <- aic
  
  if(aic > best_aic) {
    break
  } else {
    best_aic <- aic
  }
}

print(results)
```

```{r}
#Herausfinden, was $predictor1 für ein Prädiktor ist
index_predictor1 <- 1
spaltenname_predictor1 <- names(modified_data)[predictors[index_predictor1]]
print(spaltenname_predictor1)

#Herausfinden, was $predictor2 für ein Prädikator ist
index_predictor2 <- 2
spaltenname_predictor2 <- names(modified_data)[predictors[index_predictor2]]
print(spaltenname_predictor2)
```

Regarding the calculated AIC-values it becomes clear that the single predictor “PPFD_IN” is not the most precise one. To get a better result, the predictor “TA_F_MDS” and “SW_IN_F_MDS” in combination with “PPFD_IN” are influencing the dependent variable “GPP_NT_VUT_REF”. Regarding the theories about the GPP_NT_VUT_REF this makes sense because the shortwave_radiation influences as well as the temperature contribute to the growth of plants and their total amount of carbon dioxide fixation. Nevertheless, the shortwave-radiation does not influence the GPP that much as the TA_F_MDS and provides an higher AIC which means that the dependent variable GPP_NT_VUT_REF is influenced by PPFD_IN and TA_F_MDS in combination.

The following plot provides an easier interpretation of these results:
```{r}
#Säulendiagramm
library(ggplot2)
results_exercise <- data.frame(Predictor = names(results), AIC = unlist(results))
#rename the $predictor1
results_exercise$Predictor <- ifelse(results_exercise$Predictor == "predictor1", "TA_F_MDS (Predictor 1)", results_exercise$Predictor)
#rename the $predictor2
results_exercise$Predictor <- ifelse(results_exercise$Predictor == "predictor2", "SW_IN_F_MDS (Predictor 2)", results_exercise$Predictor)
results_exercise

p <- ggplot(results_exercise, aes(x = Predictor, y = AIC)) +
  geom_bar(stat = "identity", fill = "yellow3") +
  xlab("Predictor") +
  ylab("AIC") +
  ggtitle("AIC für hinzugefügte Prädikatoren")
print(p)
```

The plot shows exactly these results by having a higher bar of the predictor 2 (SW_IN_F_MDS). Therefore, only the combination of the PPFD_IN and the TA_F_MDS (Predictor 1) provides a more precise result.